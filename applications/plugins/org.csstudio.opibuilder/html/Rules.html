<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=Cp1252"/>
    <link rel="stylesheet" href="default.css" type="text/css" />
    <title>
      Rule
    </title>
  </head>
  <body>

    <h1>
      Rule
    </h1>
    <p>
To obtain customized dynamic hehaviors than just setting from properties sheet, you can attach rules or scripts to widgets or OPI.
With rules, you can make widget properties dynamically changeable without any programming. 
Widget property value will change along with the boolean expression status or input PV value. 
The execution of a rule is triggered by its input PV(s), so at least one trigger PV is needed for a rule.
</p>
<p> 
To have more complex dynamic behaviors if rules cannot achieve, you will need to attach <a href="Script.html">scripts</a> to the widget or OPI.
Diffrent with script, rules is part of the OPI file, so no additional file is needed.    
</p>

<h3>
Steps to attach rules to a widget:
</h3>
<ol>
	<li>Select <b>Rules</b> property in property sheet view. You will see "Attache Rules" dialog.
	<p>
	<img src="img/attach_rules.gif" alt="Attach Rules" />
	</p>
	</li>
	<li>In <b>Attach Rules</b> Dialog, you can add more than one rule. When you add a rule or double click a rule, a rule edit dialog
	will pop out. In which,
	 <ul>
	 	<li>Rule Name: the name of the rule.</li>
	 	<li>Property: the property which will be dynamically changed. Only simple property types are supported by now: 
	 	Boolean Property,Double Property, Integer Property, Combo Property, String Property, File Path Property, Color Property
	 	and Font Property.</li>
	 	<li>Output Expression: If this is not selected, the output value will be constant value as set in Expression table. 
	 	If it is selected, the output value will be an expression (will be explained later).</li>
	 	<li>Boolean Expression: the condition expression, the property will be set to the corresponding output value when it is true (will be explained later).</li>
	 	<li>Input PVs: the input PVs for the rule. If trigger is true, value change of the PV will trigger the execution of the rule.</li>
	 	<li>See Generated Script: A rule is actually a simple script attached to the widget. Press this button, you can see the 
	 	equivalent script to the rule.</li>
	 </ul>
	<p>
	<img src="img/RuleDialog.gif" alt="Rule edit dialog" />	
	</p>
	
</ol>

<h3>Boolean Expression</h3>
<p>
The Boolean Expression is javascript boolean expression, so all javascript operators are applicable here. Besides, all input PVs of the rule
are also accessible in the expression. 
<ul>
	<li>Get double value: <code>pv{index}</code>. For example: <code>pv0 > pv1</code></li>
	<li>Get Long Integer value: <code>pvInt{index}</code>. For example: <code>pvInt0 == 5</code></li>
	<li>Get String value: <code>pvStr{index}</code>. For example: <code>pvStr0 == "apple"</code></li>
	<li>Get Severity: <code>pvSev{index}</code>. It is an integer value, in which: 0: OK; -1: Invalid; 1: Major; 2:Minor. 
	For example: <code>pvSev0 == 1 || pvSev0 ==2</code></li>
</ul>


<h3>Output Expression</h3>
<p>Besides outputing a constant value to the property based on the boolean expression value, you can also output an expression value to
the property. For example, if you want make the String value of a PV as the URL of a web browser widget, you can set the output expression 
to <code>pvStr0</code>. If you want to skip the boolean expression, simply set boolean expression to <code>true</code>. 
<p>
	<img src = "img/RuleDialog_outputExpression.gif" alt = "Output Expression" />
</p>
  
</body>
</html>
