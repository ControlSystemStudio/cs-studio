<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=Cp1252"/>
    <link rel="stylesheet" href="default.css" type="text/css" />
    <title>
     WebOPI
    </title>
</head>
<body>

<h2>WebOPI Developer Manual</h2>

<p><b>Note: </b>This guide is based on Eclipse 3.7.1, RAP 1.5.0 and has also
been tested with Eclipse 4.3.
Equal or higher versions are required, but you may experience unpredicted 
problems with other versions.</p>

<h3>Install Eclipse for RCP and RAP developers</h3>
<p>WebOPI is developed on RAP, so you must use the 
<code>Eclipse for RCP and RAP developers</code> IDE from 
<a href="http://www.eclipse.org/downloads/">http://www.eclipse.org/downloads/</a>.
</p>

<h3>Get WebOPI source code</h3>
<p>
Read this article to get CSS source code: 
<a href="https://github.com/ControlSystemStudio/cs-studio/wiki/SourceRepository">
https://github.com/ControlSystemStudio/cs-studio/wiki/SourceRepository</a>.
After you got the source code, you need to import the required plugins into your workspace.
For the exact list of plugins, refer to the <code>&lt;plugins&gt;</code> section
of the file <code>org.csstudio.opibuilder.rap/webopi.warproduct</code>.
Note that some plugins will be found under <code>core/plugins</code>, others
under <code>applications/plugins</code>.
At the time of writing this, the list was:
<ul>
<li>core/plugins/org.antlr.runtime</li>
<li>core/plugins/org.csstudio.autocomplete</li>
<li>core/plugins/org.csstudio.autocomplete.ui</li>
<li>core/plugins/org.csstudio.csdata</li>
<li>core/plugins/org.csstudio.data</li>
<li>core/plugins/org.csstudio.java</li>
<li>core/plugins/org.csstudio.openfile</li>
<li>core/plugins/org.csstudio.platform.libs.epics</li>
<li>core/plugins/org.csstudio.platform.libs.jdbc</li>
<li>core/plugins/org.csstudio.platform.utility.rdb</li>
<li>core/plugins/org.csstudio.rap.core</li>
<li>core/plugins/org.csstudio.rap.ui.util (and <u>not</u> org.csstudio.ui.util !)</li>
<li>core/plugins/org.csstudio.security</li>
<li>core/plugins/org.csstudio.security.ui</li>
<li>core/plugins/org.csstudio.simplepv</li>
<li>core/plugins/org.csstudio.ui.menu</li>
<li>core/plugins/org.csstudio.utility.pvmanager</li>
<li>core/plugins/org.csstudio.utility.pvmanager.epics</li>
<li>core/plugins/org.csstudio.utility.pvmanager.extra</li>
<li>core/plugins/org.csstudio.utility.pvmanager.loc</li>
<li>core/plugins/org.csstudio.utility.pvmanager.sim</li>
<li>core/plugins/org.csstudio.utility.pvmanager.sys</li>
<li>core/plugins/org.csstudio.utility.pvmanager.ui</li>
<li>core/plugins/org.csstudio.utility.pvmanager.vtype</li>
<li>core/plugins/org.csstudio.utility.singlesource</li>
<li>core/plugins/org.csstudio.utility.singlesource.rap</li>
<li>core/plugins/org.csstudio.workspace</li>
<li>core/plugins/org.epics.util</li>
<li>core/plugins/org.epics.vtype</li>
<li>applications/plugins/javax.mail</li>
<li>applications/plugins/org.apache.batik</li>
<li>applications/plugins/org.csstudio.apputil</li>
<li>applications/plugins/org.csstudio.apputil.ui</li>
<li>applications/plugins/org.csstudio.archive.rdb</li>
<li>applications/plugins/org.csstudio.archive.reader</li>
<li>applications/plugins/org.csstudio.archive.reader.rdb</li>
<li>applications/plugins/org.csstudio.archive.vtype</li>
<li>applications/plugins/org.csstudio.email</li>
<li>applications/plugins/org.csstudio.email.ui</li>
<li>applications/plugins/org.csstudio.logbook</li>
<li>applications/plugins/org.csstudio.opibuilder</li>
<li>applications/plugins/org.csstudio.opibuilder.rap</li>
<li>applications/plugins/org.csstudio.opibuilder.widgets</li>
<li>applications/plugins/org.csstudio.opibuilder.widgets.rap</li>
<li>applications/plugins/org.csstudio.opibuilder.widgets.symbol</li>
<li>applications/plugins/org.csstudio.simplepv.pvmanager</li>
<li>applications/plugins/org.csstudio.swt.widgets</li>
<li>applications/plugins/org.csstudio.swt.xygraph</li>
<li>applications/plugins/org.csstudio.swt.xygraph.rap</li>
<li>applications/plugins/org.csstudio.trends.databrowser2</li>
<li>applications/plugins/org.csstudio.trends.databrowser2.opiwidget</li>
<li>applications/plugins/org.csstudio.trends.databrowser2.rap</li>
<li>applications/plugins/org.jdom</li>
<li>applications/plugins/org.python</li>
</ul>
<p>
If you also want to use utility_pv as the PV connection layer, add the following:
</p>
<ul>
<li>applications/plugins/org.csstudio.simplepv.utilitypv</li>
<li>core/plugins/org.csstudio.utility.pv</li>
<li>core/plugins/org.csstudio.utility.pv.epics</li>
<li>core/plugins/org.csstudio.utility.pv.simu</li>
</ul>
<p>

<p>You may import both utility_pv and pvmanager plugins and select which one to use via the preference
<code>org.csstudio.opibuilder/pv_connection_layer</code>
</p>

<h3>Set Target Platform</h3>
 <p>
      RAP applications need to be compiled against the RAP runtime.
      To do so, the runtime needs to be set as the target platform in Eclipse.     
      <ol>
        <li>Open <code>org.csstudio.opibuilder.rap->webopi.target</code>.</li>
        <li>Select the local folder location, and click <code>Edit...</code> on the right.</li>
		<li>Change it to the local physical location of 
		<code>org.csstudio.rap.core/third_party_plugins/GEF_RAP_1.5.0</code>
        <li>Save and click on <code>Set as Target Platform</code> on the upper right corner.</li>
      </ol>
 
    <p>
      Note: if doing this with a workspace that already contains projects that
      depend on the target, you may get compile errors. Restarting Eclipse and/or
      doing a clean build will help.
    </p>


<p>If you got any unpredicted problem, you can resort to following resources: <br>
<br><code>Eclipse Online Help->Rap Developer Guide</code><br>
<a href="http://www.eclipse.org/rap/">http://www.eclipse.org/rap/</a><br>
<a href="http://www.vogella.de/articles/EclipseRAP/article.html">
http://www.vogella.de/articles/EclipseRAP/article.html</a>
</p>



<h3>Launch WebOPI from Eclipse</h3>
<ol>
<li>Make corresponding changes to <code>preferences.ini</code> under <code>org.csstudio.opibuilder</code> and 
<code>org.csstudio.platform.libs.epics</code> plugin. Alternatively, you can create your own
<code>css_rap.ini</code> under your home directory.</li>
<li>Open <code>fragment.xml</code> in <code>org.csstudio.opibuilder.rap</code> plugin and click 
<code>Launch a RAP application</code>.</li>
</ol>
<p>
It has been observed that this will start a web browser for 
<code>http://127.0.0.1:10081/rap</code>, which will fail.
Change your web browser to look at 
<code>http://127.0.0.1:10081/</code>, that is: Use the same address and port, but a root path.
</p>
<p>
If you still get errors to open the web page, try following steps:
<ul>
<li>Stop and refresh the webpage.</li>
<li>Terminate WebOPI from Console view.
    Go to <code>Run Configuration->RAP Application->WebOPI->Bundles</code>.
    Check that no <code>*.rcp.*</code> bundles or fragments are included.
    Check the output of <code>Validate Bundles</code>.
    Beware of <code>Add Required Bundles</code>, which could add <code>*.rcp.*</code>
    bundles or fragments that you happen to have in the workspace.
</li>
<li>Run again.</li>
</ul>
</p>
<h3>Build WAR file</h3>
<p>First, install the WAR Products tooling from the p2 repository for your version of Eclipse into your IDE:</p>

<ul>
<li><a href="http://download.eclipse.org/releases/indigo">http://download.eclipse.org/releases/indigo</a></li>
<li><a href="http://download.eclipse.org/releases/kepler">http://download.eclipse.org/releases/kepler</a></li>
</ul>

<p>Search <code>War products</code> will help to locate it. Restart Eclipse when you are prompted to do so.
</p>
<p>Open <code>webopi.warproduct</code> and click on <code>Validate</code> to see
if any required bundles are missing. If you see any missing required bundles, go to
Configuration page, click <code>Add...</code> to add the required bundles only. 
<b>Note: </b> Do not click <code>Add Required Plug-ins</code>, which may add unnecessary
plugins and result in the deployment fail. </p>

<p>After fix all problems from <code>Validate</code>, click 
<code>Eclipse WAR product export wizard</code>
to export the WAR file. </p>

<p>
After successfully exported the WAR file, here is the last mile: 
to allow multiple sessions in same browser, you need to disable cookies:
copy the folder
<code>META-INF</code> under <code>org.csstudio.opibuilder.rap/html</code> folder to the same directory of webopi.war.
Then execute the command <code>jar uf webopi.war META-INF/</code> to add this folder to webopi.war.
Now, you can deploy the WAR file on a tomcat server. See
<a href="WebOPI.html">WebOPI user manual</a>.
</p>


 <br>
 <br>
 
</body>
</html>
