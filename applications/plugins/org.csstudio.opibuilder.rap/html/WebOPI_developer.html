<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=Cp1252"/>
    <link rel="stylesheet" href="default.css" type="text/css" />
    <title>
     WebOPI
    </title>
</head>
<body>

<h2>WebOPI Developer Manual</h2>

<p><b>Note: </b>This guide is based on Eclipse 3.7.1, RAP 1.5.0. Equal or higher versions
are required, but you may experience unpredicted 
problems with other versions.</p>

<h3>Install Eclipse for RCP and RAP developers</h3>
<p>WebOPI is developed on RAP, so you must have RAP installed in your Eclipse. You can simple download 
<code>Eclipse for RCP and RAP developers</code> from 
<a href="http://www.eclipse.org/downloads/">http://www.eclipse.org/downloads/</a>.
</p>

<h3>Get WebOPI source code</h3>
<p>
Read this article to get CSS source code: 
<a href="http://sourceforge.net/apps/trac/cs-studio/wiki/SourceRepository">
http://sourceforge.net/apps/trac/cs-studio/wiki/SourceRepository</a>.
After you got the source code, you need to import these plugins to your workspace:
<ul>
<li>core\plugins\org.antlr.runtime</li>
<li>core\plugins\org.csstudio.autocomplete</li>
<li>core\plugins\org.csstudio.autocomplete.ui</li>
<li>core\plugins\org.csstudio.csdata</li>
<li>core\plugins\org.csstudio.data</li>
<li>core\plugins\org.csstudio.java</li>
<li>core\plugins\org.csstudio.openfile</li>
<li>core\plugins\org.csstudio.rap.core</li>
<li>core\plugins\org.csstudio.rap.ui.util</li>
<li>core\plugins\org.csstudio.platform.libs.epics</li>
<li>core\plugins\org.csstudio.platform.libs.epics.linux</li>
<li>core\plugins\org.csstudio.platform.libs.epics.macosx</li>
<li>core\plugins\org.csstudio.platform.libs.epics.win32</li>
<li>core\plugins\org.csstudio.simplepv</li>
<li>core\plugins\org.csstudio.utility.singlesource</li>
<li>core\plugins\org.csstudio.utility.singlesource.rap</li>
<li>core\plugins\org.csstudio.ui.menu</li>
<li>core\plugins\org.epics.util</li>
<li>core\plugins\org.epics.vtype</li>
<li>applications\plugins\org.apache.batik</li>
<li>applications\plugins\org.csstudio.apputil</li>
<li>applications\plugins\org.csstudio.opibuilder</li>
<li>applications\plugins\org.csstudio.opibuilder.rap</li>
<li>applications\plugins\org.csstudio.opibuilder.widgets</li>
<li>applications\plugins\org.csstudio.opibuilder.widgets.rap</li>
<li>applications\plugins\org.csstudio.opibuilder.widgets.symbol</li>
<li>applications\plugins\org.csstudio.swt.widgets</li>
<li>applications\plugins\org.csstudio.swt.xygraph</li>
<li>applications\plugins\org.csstudio.swt.xygraph.rap</li>
<li>applications\plugins\org.jdom</li>
<li>applications\plugins\org.python</li>
</ul>
<p>
If you want to use utility_pv as pv connection layer, import following plugins:
</p>
<ul>
<li>applications\plugins\org.csstudio.simplepv.utilitypv</li>
<li>core\plugins\org.csstudio.utility.pv</li>
<li>core\plugins\org.csstudio.utility.pv.epics</li>
<li>core\plugins\org.csstudio.utility.pv.simu</li>
</ul>
<p>
If you want to use pvmanager as pv connection layer, import following plugins:
</p>
<ul>
<li>applications\plugins\org.csstudio.simplepv.pvmanager</li>
<li>core\plugins\org.csstudio.utility.pvmanager</li>
<li>core\plugins\org.csstudio.utility.pvmanager.epics</li>
<li>core\plugins\org.csstudio.utility.pvmanager.extra</li>
<li>core\plugins\org.csstudio.utility.pvmanager.loc</li>
<li>core\plugins\org.csstudio.utility.pvmanager.sim</li>
<li>core\plugins\org.csstudio.utility.pvmanager.sys</li>
<li>core\plugins\org.csstudio.utility.pvmanager.ui</li>
<li>core\plugins\org.csstudio.utility.pvmanager.vtype</li>
</ul>

<p>You may import both utilty_pv and pvmanager plugins and choose one to use from preference
<code>org.csstudio.opibuilder/pv_connection_layer</code>
</p>

<h3>Set Target Platform</h3>
 <p>
      RAP applications need to be compiled against the RAP runtime.
      To do so, the runtime needs to be set as the target platform in Eclipse.     
      <ol>
        <li>Open <code>org.csstudio.opibuilder.rap->webopi.target</code>.</li>
        <li>Select the local folder location, and click <code>Edit...</code> on the right.</li>
		<li>Change it to the local physical location of 
		<code>org.csstudio.rap.core/third_party_plugins/GEF_RAP_1.5.0</code>
        <li>Save and click on <code>Set as Target Platform</code> on the upper right corner.</li>
      </ol>
 
    <p>
      Note: if doing this with a workspace that already contains projects that
      depend on the target, you may get compile errors. Restarting Eclipse and/or
      doing a clean build will help.
    </p>


<p>If you got any unpredicted problem, you can resort to following resources: <br>
<br><code>Eclipse Online Help->Rap Developer Guide</code><br>
<a href="http://www.eclipse.org/rap/">http://www.eclipse.org/rap/</a><br>
<a href="http://www.vogella.de/articles/EclipseRAP/article.html">
http://www.vogella.de/articles/EclipseRAP/article.html</a>
</p>



<h3>Launch WebOPI from Eclipse</h3>
<ol>
<li>Make corresponding changes to <code>preferences.ini</code> under <code>org.csstudio.opibuilder</code> and 
<code>org.csstudio.platform.libs.epics</code> plugin. Alternatively, you can create your own
<code>css_rap.ini</code> under your home directory.</li>
<li>Open <code>fragment.xml</code> in <code>org.csstudio.opibuilder.rap</code> plugin and click 
<code>Launch a RAP application</code>. /li>
</ol>
<p>
If you get errors to open the web page, try following steps:
<ul>
<li>Stop and refresh the webpage.</li>
<li>Terminate WebOPI from Console view. Go to <code>
Run Configuration->RAP Application->WebOPI->Bundles</code>. 
Click <code>Add Required Bundles</code> and then click <code>Validate Bundles</code>.</li>
<li>Run again.</li>
</ul>
</p>
<h3>Build WAR file</h3>
<p>First, install the WAR Products tooling from this p2 repository 
<a href="http://download.eclipse.org/releases/indigo">http://download.eclipse.org/releases/indigo</a> into your IDE.
Search <code>War products</code> will help to locate it. Restart Eclipse when you are prompted to do so.
</p>
<p>Open <code>webopi.warproduct</code> and click on <code>Validate</code> to see
if any required bundles are missing. If you see any missing required bundles, go to
Configuration page, click <code>Add...</code> to add the required bundles only. 
<b>Note: </b> Do not click <code>Add Required Plug-ins</code>, which may add unnecessary
plugins and result in the deployment fail. </p>

<p>After fix all problems from <code>Validate</code>, click 
<code>Eclipse WAR product export wizard</code>
to export the WAR file. </p>

<p>
After successfully exported the WAR file, here is the last mile: 
to allow multiple sessions in same browser, you need to disable cookies:
copy the folder
<code>META-INF</code> under <code>org.csstudio.opibuilder.rap/html</code> folder to the same directory of webopi.war.
Then execute the command <code>jar uf webopi.war META-INF/</code> to add this folder to webopi.war.
Now, you can deploy the WAR file on a tomcat server. See
<a href="WebOPI.html">WebOPI user manual</a>.
</p>


 <br>
 <br>
 
</body>
</html>
