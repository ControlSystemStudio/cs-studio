<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>

<link rel="stylesheet" href="../../PRODUCT_PLUGIN/book.css"
    type="text/css"></link>
<link rel="stylesheet" href="section_numbers.css" type="text/css"></link>

<title>Alarm System</title>
</head>

<body>
    <h1>Alarm System</h1>

    <span class="index"> - <a href="#overview">Overview</a>
     - <a href="#principles">Principles</a>
     - <a href="#architecture">Architecture</a>
     - <a href="#perspective">Perspective</a>
     - <a href="#tree">Alarm Tree</a>
     - <a href="#table">Alarm Table</a>
     - <a href="#panel">Alarm Area Panel</a>
     - <a href="#preferences">Preferences</a>
     - <a href="#edit">Editing Configuration</a>
     - <a href="#pv_config">Alarm PV Configuration</a>
     - <a href="#annunciation">Annunciation</a> -
    </span>

    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <h2>
        <a name="overview">Overview</a>
    </h2>
    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <p>The Alarm System allow users to view and handle the alarms
        triggered by Process Variables (PVs) on front-end computers (IOCs). To
        understand the behavior of alarms in the alarm system, please take a
        few minutes to read about its general principles.</p>

    <h3>Purpose</h3>
    <p>
        Alarms are <u>not</u> another interlock or protection system. Unlike
        interlocks, alarms do not trigger an automated response to handle a
        well understood situation. Instead, alarms inform operators of a
        problem that can have multiple reasons, a problem that is too complex
        to be handled automatically, an issue that <u>relies on a
            qualified operator</u> to find a solution based on experience and skill.
    </p>
    <p>Alarms are supposed to</p>
    <ul>
        <li>notify operators about a problem</li>
        <li>effectively help operators take the correct action at the
            correct time,</li>
        <li>provide guidance for handling it</li>
        <li>be presented at a manageable rate.</li>
    </ul>
    <p>Operators are expected to acknowledge each active alarm, because
        the alarm system has no other way of knowing if operators are aware of
        an alarm. Annunciations for new occurrences of the same alarm are
        suppressed until the initial alarm is acknowledged, assuming that
        operators are still handling the first, un-acknowledged alarm
        instance.</p>
    <p>Before acknowledging an alarm, operators can use the alarm GUI
        to</p>
    <ul>
        <li>access guidance on how to handle the alarm</li>
        <li>access operator screens that show the actual alarm PV, the
            reason why it went into alarm</li>
        <li>use the Data Browser or other tools to inspect the alarm or
            related PVs</li>
        <li>access operator screens that allow them to handle the alarm</li>
        <li>make an E-Log entry</li>
    </ul>


    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <h2>
        <a name="principles">General Alarm Principles</a>
    </h2>
    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

    <h3>Where are alarms generated?</h3>
    <p>
        Alarms are triggered by Process Variables (PVs) on the front-end
        computers (IOCs). Adding these <u>Trigger PVs</u> to the alarm server
        configuration generates the actual alarms with an alarm description,
        guidance information, and links to related operator displays or web
        pages.
    </p>

    <h3>Alarm Severity and Status Message</h3>
    <p>Levels of severity can help users to prioritize their work,
        especially when many alarms occur at the same time.</p>
    <p>There are four alarm severity levels:</p>
    <ul>
        <li><font color="#00FF00">OK</font> - actually meaning that there
            is no alarm</li>
        <li><font color="#A0A000">MINOR</font> - low severity</li>
        <li><font color="#FF0000">MAJOR</font> - higher severity</li>
        <li><font color="#FF00FF">INVALID</font> - highest severity</li>
    </ul>
    <p>The INVALID severity indicates a control system problem: The PV
        has no known value. On an operational machine, not knowing the true
        state of the system can be very bad, hence the highest alarm severity.
        On maintenance days, INVALID alarms can be the result of equipment
        simply being turned off, i.e. not a severe problem. The maintenance
        mode described below can help with that situation.</p>

    <p>The severity of an alarm is provided by the control system
        trigger PV. It needs to be configured by the IOC engineer.</p>
    <p>In addition, each Trigger PV provides an alarm message (status)
        for each alarm. This message can indicate if the alarm is caused by
        some value being too high or too low, but it cannot replace the more
        elaborate guidance information that needs to be configured within the
        alarm system user interface.</p>


    <h3>Alarm Severity/Status vs. Current Severity/Status</h3>
    <p>There are two types of severity and status for each alarm
        trigger:</p>
    <ul>
        <li>"Current Severity" and "Current Status" are directly read
            from the alarm trigger PV, representing its current severity and
            status that you would also see on other operator screens that happen
            to display this PV.</li>
        <li>"Alarm Severity" and the "Alarm Status" are the severity and
            status of the most severe event that the alarm server observed for
            the PV. When the alarm is configured to "latch", the alarm server
            remembers the highest alarm severity of the PV until it is manually
            acknowledged.</li>
    </ul>
    <p>The "Alarm Severity" can differ from the "Current Severity" when
        the underlying alarm PV already recovered but the alarm server was
        configured to "latch" the alarm until operator acknowledgement.</p>

    <a name="AlarmState"> </a>
    <h3>Alarm States</h3>
    <img class="float" alt="Alarm State Diagram for Latched PV"
        src="latched.png" />
    <img class="float" alt="Alarm State Diagram for Un-Latched PV"
        src="unlatched.png" />
    <p>Fundamentally, an alarm can have 3 states:</p>
    <ul>
        <li><font color="#00FF00">OK</font><br> There is no alarm.
            The trigger PV's severity is and has been OK.</li>
        <li><font color="#FF0000">Active Alarm</font><br> The
            trigger PV's severity changed to not-OK. The alarm is displayed in
            the alarm system user interface, showing the time and value of the
            original occurrence, waiting for an operator to analyze and fix the
            problem.</li>
        <li><font color="#FF8080">Acknowledged Alarm</font><br> An
            operator has acknowledged the alarm. While the PV's severity might
            still be not-OK, the alarm system user interface shows that the alarm
            is being handled. Once the trigger PV returns to OK, the alarm
            reverts to the "OK" state.</li>
    </ul>
    <p>In reality, alarms are more complicated because of their very
        nature. If the reason for an alarm was known, it could have been fixed
        long ago, or automated countermeasures would have been implemented.
        But an alarm is an alarm because it requires human intelligence to
        analyze and handle it. Therefore alarm trigger PVs will sometimes go
        in and out of alarm for some time, or only show a brief alarm which
        seems to recover on its own. One purpose of the alarm system is to
        catch even brief alarms, and to reduce the noise from alarms that
        cycle between OK and some alarm state.</p>
    <p>Alarm are typically configured to "latch" and behave as shown in
        the first state diagram. Assume that the alarm is initially OK. As
        soon as an alarm trigger PV sends for example a MINOR alarm severity,
        the alarm system will latch the time and value of that occurrence and
        display the alarm in the user interface. If the alarm was configured
        for annunciation, the alarm description will be annunciated.</p>
    <p>Ideally, an operator investigates the alarm, fixes the
        underlying reason, acknowledges the alarm, the PV returns to OK and
        the alarm clears. In reality, other things can happen. The PV might
        only cause a brief nuisance trip, then quickly return to OK on its
        own. Or the PV might goes in and out of alarm. Either case really
        indicates a problem in the alarm trigger PV. Still, the alarm system
        latches the alarm at the original occurrence and annunciates only once
        to reduce 'chatter'. If the alarm re-occurs while the original alarm
        is still not acknowledged, it is not annunciated again because we
        assume that operators are still investigating the initial alarm, or
        just too busy to look at any alarms right now. In either case, another
        annunciation would only cause noise. The alarm system can also be
        configured with delays to only alarm if the trigger PV persists for a
        certain time, which can be used as a workaround for less than perfect
        alarm trigger PVs.</p>
    <p>When a MINOR alarm is followed by a MAJOR alarm, or generally a
        higher level alarm, that causes another annunciation because it is
        considered a different, more important situation. On the other hand,
        if an INVALID alarm relaxes to MAJOR or generally a lower severity,
        the display will update to reflect the 'current' severity but the
        alarm severity remains latched to the highest alarm level.</p>
    <p>Acknowledging an alarm means to acknowledge the current alarm
        severity.</p>
    <p>Acknowledge Example 1: A trigger PV goes MAJOR, alarm system
        goes into MAJOR alarm. When acknowledged, the alarm is
        MAJOR-acknowledged. Should the PV relax to MINOR, the current state of
        the alarm will be MINOR, but the overall alarm state stays at
        MAJOR-acknowledged. If the PV actually cycles between MINOR and MAJOR,
        there will be no new annuncuations because the operator already
        acknowledged the MAJOR alarm. Finally, once the PV clears to OK, all
        will be OK.</p>
    <p>Acknowledge Example 2: A trigger PV goes MAJOR, alarm system
        goes into MAJOR alarm. Operator looks at the problem, improves the
        situation but can't fully fix it, yet, so the PV stays in MINOR alarm.
        The alarm system will show that there was a MAJOR alarm, and right now
        the PV is still in MINOR alarm. When acknowledged, the alarm system
        state changes to MINOR-acknowledged. If the PV clears to OK, all will
        be OK. On the other hand, should the PV go back into MAJOR alarm, this
        would cause a new annunciation because we only acknowledged when the
        PV was at a MINOR severity level.</p>
    <p>Acknowledged alarms are less visible in the alarm system user
        interface so that new, not-yet-acknowledged alarms are more obvious.
        Operators can manually un-acknowledged alarms, which might be useful
        to make them more visible again when trying to decide how to handle
        several alarms.</p>
    <p>
        In summary, acknowledging an alarm means to acknowledge the current
        severity of the PV, and an alarm will fully 'clear', i.e. disappear
        from the alarm table when the alarm trigger PV returns to OK <u>and</u>
        the alarm is acknowledged.
    </p>



    <h3>Non-Latching Alarms</h3>
    <p>
        The second diagram shows the behavior of alarms that are <u>not</u>
        configured to latch. You will notice that it is very similar to the
        latched alarm behavior except that non-latching alarms do not require
        acknowledgement. They may be acknowledged to remove them from the list
        of 'active' alarms, but they clear automatically once the trigger PV
        relaxes to "OK" without requiring a manual alarm acknowledgement.
    </p>
    <p>Typical use cases for non-latching alarms:</p>
    <ul>
        <li>Something else in the control system already latches the
            alarm trigger PV. For example, the alarm trigger PV could be an
            "overtemperature" indicator of a power supply where the power supply
            already latches this indicator until it is reset at the power supply.
        </li>
        <li>A trigger PV is known to cause frequent brief alarms, and it
            would be too much work for operators to acknowledge each occurrence.
            In this case, configuring the alarm not to latch is a workaround, but
            in an ideal world you would fix the root cause: Remove noise from the
            alarm trigger PV, or configure the alarm system with a delay.</li>
    </ul>


    <h3>Annunciation</h3>
    <p>
        For alarms configured to annunciate, whenever a new alarm or a higher
        severity alarm triggers, the severity and description of the alarm
        will be <a href="#annunciation">annunciated</a>.
    </p>


    <h3>'Maintenance' Mode</h3>
    <p>During machine maintenance, devices are turned off on purpose,
        but related alarms were not disabled, resulting in numerous nuisance
        alarms.</p>
    <p>It is impossible for the computer to decide if an alarm should
        be disabled automatically. IOC engineers can add logic to
        automatically suppress alarms, but this is a rather complex and time
        consuming task.</p>
    <p>
        Alarms can be disabled manually in the <a href="#pv_config">Alarm
            PV Configuration</a>. Reports of disabled alarms can help to review which
        alarms were disabled at what time, to avoid leaving alarms disabled by
        accident. But this process is again tedious.
    </p>
    <p>While nuisance alarms during maintenance periods are hard to
        avoid, one common source of alarms are INVALID alarms caused by IOCs,
        PLCs or network equipment being turned off. The 'Maintenance' Mode of
        the alarm server can help handle the flurry of INVALID alarms as
        follows:</p>
    <ol>
        <li>INVALID alarms are not annunciated (except <a
            href="#priority">'priority' annunciations</a>).</li>
        <li>INVALID alarms are automatically acknowledged (same
            'priority' exception).</li>
        <li>When trigger PVs leave the INVALID state, for example go into
            MINOR, that is considered a new alarm.</li>
    </ol>

    <p>
        The (acknowledged) INVALID alarms are still displayed, but the missing
        annunciation reduces chatter in the control room.<br> The
        automatic acknowledgement moves them off the list of active alarms,
        reducing visual clutter.<br> The third point asserts that
        possibly valid alarms after a device is again accessible are not
        forgotten: In 'normal' mode, a transition from INVALID(-acknowledged)
        to MAJOR alarm would not cause an annunciation because there was
        already a more severe alarm level, INVALID, and the device situation
        actually improved from INVALID to MAJOR.<br> In 'maintenance'
        mode, the INVALID was automatically acknowledged, and a MAJOR alarm is
        now considered a new situation that the operator should review and
        manually acknowledge.
    </p>
    <p>Maintenance mode is enabled or disabled via this icon in the
        alarm tree and table GUI, which also indicates the current mode:</p>
    <ul>
        <li><img src="icons/operate.gif" /> Normal Operating Mode, press
            to enable Maintenance Mode</li>
        <li><img src="icons/maintenance_act.gif" /> Maintenance Mode,
            press to return to normal operating mode</li>
    </ul>



    <div class="clear" />


    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <h2>
        <a name="architecture">Architecture</a>
    </h2>
    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

    <img class="float" alt="Alarm System" src="AlarmSystem.png" />
    <p>Technically, the alarm system consists of several elements:</p>
    <ul>
        <li>IOCs:<br> Control System IOCs provide the Alarm Trigger
            PVs which indicate alarm conditions. In principle, one can display
            those PVs on generic operator screens, where they would for example
            show up as yellow or red. <br> Benefits of the alarm system over
            a basic operator screen:
            <ul>
                <li>Alarm can be annunciated.</li>
                <li>Alarm can latch to indicate the time of the original alarm.</li>
                <li>Additional guidance and links to related displays are
                    accessible right from the alarm.</li>
                <li>When multiple alarms coincide, they can be sorted by for
                    example severity or time.</li>
            </ul>
        </li>
        <li>Alarm Server:<br> The Alarm Server receives alarms from
            IOCs via Channel Access and sends alarm messages to a JMS Server. It
            also receives the acknowledgements from Alarm System GUIs. Most of
            the alarm logic is performed by the alarm server.
        </li>
        <li>Alarm System GUI:<br> The Alarm System GUI, basically a
            table and tree view of current alarms in CSS, allows users to view
            current alarms, acknowledge them, invoke operator displays related to
            the alarm, browse the alarm history, or change the alarm
            configuration.
        </li>
        <li>Annunciator, JMS2Speech:<br> The Annunciator included in
            the CSS alarm GUI or an alternate stand-alone JMS2Speech tool
            annunciate new alarms. Whenever a PV's severity changed to a <font
            color="#ff0000">higher severity</font>, the PV's description will be
            annunciated <font color="#ff0000">once</font>.
        </li>
        <li>JMS Server:<br> The JMS Server is the message bus that
            allows the Alarm Server, GUI, JMS2Speech to communicate.
        </li>
        <li>JMS2RDB:<br> This tool can write all JMS traffic to a
            Relational Database (RDB), allowing analysis of the most frequent
            alarms, reconstruction of the time line of a specific alarm, and
            more.
        </li>
    </ul>

    <p>This manual focuses on how to use Alarm System GUI, not on the
        setup of the alarm server.</p>

    <div class="clear" />


    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <h2>
        <a name="perspective">Alarm Perspective</a>
    </h2>
    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <img class="float" src="AlarmPerspective.png" alt="Alarm Perspective" />
    <p>Especially for first-time users it might be advisable to switch
        to the designated Alarm Perspective, which results in a predefined
        arrangement of the Alarm Tree and Alarm Table.</p>

    <h3>Activate or Reset</h3>
    <p>
        After opening an Alarm Table or Tree from the
        <code>CSS/Alarm</code>
        menu, access the Alarm Perspective by right-clicking in the Alarm
        Table or Tree and selecting
        <code>Alarm Perspective</code>
        . This action will switch to the Alarm Perspective, or - if it was
        already active - allow you to reset it to its original state, in case
        windows have been rearranged.
    </p>


    <h3>Rearranging the Perspective</h3>
    <p>You can simply close, minimize or maximize an Alarm Table or
        Alarm Tree window via the usual icon in the window title bar or the
        context menu of the window title bar. You can also adjust the size of
        each window.</p>

    <div class="clear" />


    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <h2>
        <a name="tree">Alarm Tree</a>
    </h2>
    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <img class="float" src="AlarmTree.png" alt="Alarm Tree" width="598"
        height="793" />
    <p>
        The Alarm Tree provides an approach to browse the alarm configuration
        components and their related alarm status in a tree-like structure,
        which by default includes all configured alarms, active or not. You
        can open it via the menu
        <code>CSS/Alarm/Alarm Tree</code>
        .
    </p>
    <p>The Alarm Tree is synchronized with the configuration in the
        RDB. When you change the configuration from within the Alarm Tree user
        interface, the configuration in RDB will be updated, and vice versa.</p>
    <p>The Alarm Tree configuration is hierarchically arranged by</p>
    <ol>
        <li>Area: Front end, DTL, CCL, SCL, Ring, ...</li>
        <li>System: ICS, Cooling, Vacuum, RF, ...</li>
        <li>Optionally sub-system: ICS/IOCs, RF/LLRF, RF/HPRF, ...</li>
        <li>Alarm Trigger PVs on the final level.</li>
    </ol>

    <h3>Alarm State Display</h3>
    <p>In addition to displaying the alarm configuration hierarchy, the
        alarm tree also shows the current state of each item in several ways.
    </p>
    <p>The image shows an example where a MINOR/HIGH alarm occured and
        has in fact already been acknowledged ("minor-ack'ed/HIGH_ALARM"), but
        the trigger PV still exhibits the same MINOR/HIGH_ALARM, so the
        underlying issue has obviously not been fixed to fully clear the
        alarm.</p>
    <p>In addition, a MAJOR/LINK_ALARM occurred, has not been
        acknowledged, and is still active. A MAJOR/LOLO_ALARM occurred, but
        the alarm trigger PV has already cleared.</p>

    <h4>Alarm State Annotation</h4>
    <p>For each item in alarm, an annotation shows the severity and
        status of the alarm state, i.e. the most severe alarm that has
        happened and not fully cleared. For area, system and sub-system items
        this represents the state of the hierarchical sub-entries with the
        highest alarm severity.</p>
    <pre>(Alarm Severity/Alarm Status)</pre>
    <p>For alarm trigger PVs, this includes the current state of the
        PV:</p>
    <pre>(Alarm Severity/Alarm Status, Current PV Severity/Current Status)</pre>

    <h4>Alarm State Indicator, Colors</h4>
    <p>Besides the annotation there is also an alarm state indicator to
        the left of each item, a color-coded representation of the severities.
        The color of the left half of the indicator indicates the alarm
        severity, while the right half indicates the current severity.</p>
    <p>Acknowledged alarm severities are slightly darker than
        un-acknowledged severities.</p>
    <p>
        <img src="icon_ok.png" /> This example shows an overall "OK" alarm
        state.
    </p>
    <p>
        <img src="icon_major.png" /> This example shows a "Major" alarm,
        where the PV has already returned to OK.
    </p>
    <p>For disabled alarms, the indicator turns grey. If one or more
        PVs of an Area, System or Subsystem have been disabled, the associated
        indicator is partially grey.</p>

    <h4>Tool Tips</h4>
    <p>Finally, a tool-tip that appears when resting the mouse pointer
        over an alarm gives a multiple-line textual description of the alarm.
    </p>


    <h3>Alarm Tree Toolbar</h3>
    <p>The toolbar on top of Alarm Tree provides basic functions for
        the tree and selected items.</p>
    <ul>
        <li>"Send debug trigger to alarm server", <img
            src="icons/debug.gif"/>:<br> Trigger debug on alarm server
        </li>
        <li>"Configure Item", <img src="icons/configure.gif"/>:<br>
            For a PV item, you have several properties to configure: <a
            href="#pv_config">Alarm PV Configuration</a>. For the non-PV
            component, you can configure its guidance, displays and commands.
            Tree elements also "inherit" guidance, display and command
            information from its parent entries.
        </li>
        <li>"Acknowledge/Un-Acknowledge", <img
            src="icons/acknowledge.gif" />/<img src="icons/unacknowledge.gif" />:<br>
            You can acknowledge/un-acknowledge one or multiple item(s) you
            selected in the tree (Press "Ctrl" or "Shift" to select multiple
            items). For the non-PV component, all of its child items will be
            acknowledged/un-acknowledged.
        </li>
        <li>"Collapse alarm hierarchy", <img src="icons/collapse.gif" />:<br>
            Make the alarm hierarchy appear in a collapsed state.
        </li>
        <li>"Show only alarms or whole configuration?", <img
            src="icons/only_alarms.gif" />:<br> Show only alarms in the
            tree or the whole configuration. The tree will switch between the two
            modes when you click this button.
        </li>
    </ul>


    <h3>Context Menu Options</h3>
    <p>The common context menu options for all types of component in
        the tree are:</p>
    <ul>
        <li><img src="icons/clock.png" /> Time since event:<br> The
            elapsed time since the alarm happened.</li>
        <li><img src="icons/info.gif" /> Guidance messages:<br> If
            there are guidance messages configured for the item, it will be
            displayed here one by one.</li>
        <li><img src="icons/related_display.gif" /> Related displays:<br>
            If there are related displays configured for the item, it will be
            displayed here one by one. When you click one of them, the related
            display will be launched.</li>
        <li><img src="icons/command.gif" /> Commands:<br> If there
            are related commands configured for the item, it will be displayed
            here one by one. When you click one of them, the related command will
            be executed.</li>
        <li><img src="icons/acknowledge.gif" />/<img
            src="icons/unacknowledge.gif" /> Acknowledge/Un-Acknowledge:<br>
            This option will be displayed only when the item is not in an
            "OK/OK/OK" state. If this is an un-acknowledged item, the option
            would be "Acknowledge" so that you can acknowledge it, and vice
            versa.</li>
        <li><img src="icons/configure.gif" /> Configure Item:<br>
            For a PV item, you have several properties to configure: <a
            href="#pv_config">Alarm PV Configuration</a>. For the non-PV
            component, you can configure its guidance, displays and commands.
            Tree elements also "inherits" guidance, display and commands from its
            parent entries.</li>
        <li><img src="icons/rename.gif" /> Rename Item:<br> Rename
            the selected item.</li>
        <li><img src="icons/move.gif" /> Duplicate PV:<br> Create a
            new PV which has the same settings as the selected PV. This is a
            convenient way to create similar alarm PVs by configuring the first
            PV, then duplicating it. You can of course later configure the newly
            created duplicate.</li>
        <li><img src="icons/move.gif" /> Move Item:<br> Move the
            selected items to another path in the tree.</li>
        <li><img src="icons/delete.gif" /> Remove Selected Items:<br>
            Delete the selected items from the tree and hence from the
            configuration.</li>
    </ul>

    <p>For non-PV items, an additional menu option is available:</p>
    <ul>
        <li><img src="icons/add.gif" /> Add Component:<br> Add a
            new component to the configuration. You can add a child component
            under the item you selected, or add a new area regardless the
            selected item.</li>
    </ul>

    <p>For PV items, two additional menu options are available:</p>
    <ul>
        <li><img src="icons/elog.gif" /> LogBook...: <br>Open a
            logbook entry dialog editor for you to create an electronic logbook
            entry in logbook. This option will be available only when the item is
            actually in alarm, not when it is in an "OK" state.</li>
        <li><img src="icons/editcopy.png" /> Copy Pv Name to Clipboard</li>
        <li><code>CSS</code>: From this menu, you can access general CSS
            functions for the selected PVs.</li>
    </ul>


    <h3>'Drag' Support</h3>
    <p>Selected alarms can be 'dragged' out of the alarm tree into
        another program that accepts string drops. For example, one can drag
        alarms into most email tools or the web interface to an elog system.
        The dragged text will include the alarm PV, description, and its
        current state.</p>
    <p>Dragging the tree items into an Alarm Table will set the
        filtering parameters on that alarm table.</p>




    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <h2>
        <a name="table">Alarm Table</a>
    </h2>
    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <p>
        The Alarm Table provides a tabular view of currently active alarms. It
        only shows alarms that actually triggered. You can open it via the
        menu:
        <code>CSS/Alarm/Alarm Table</code>
    </p>
    <img class="float" src="AlarmTable.png" alt="Alarm Table" width="731"
        height="695"></img>

    <h3>Alarm Properties</h3>
    <p>Each active alarm has several properties:</p>
    <ul>
        <li><b>PV</b>: name of the PV that triggered the alarm.</li>
        <li><b>Description</b>: the details of the PV. It would give more
            information and more human-readable than the raw PV name. It is also
            used for annunciation.</li>
        <li><b>Time</b>: time when the alarm happened.</li>
        <li><b>Current Severity</b>: The current severity of the PV, like
            OK, MINOR, MAJOR or Invalid.</li>
        <li><b>Severity</b>: The severity of the PV remembered by alarm
            server. When the PV is configured to "latch", the alarm server
            remembers the highest alarm severity of the PV until it is manually
            acknowledged. Current severity of the PV might differ from alarm
            severity when the underlying alarm PV already recovered but the alarm
            server was configured to "latch" the alarm until operator
            acknowledgement.</li>
        <li><b>Status</b>: alarm status message like HIGH_ALARM or
            STATE_ALARM.</li>
        <li><b>Value</b>: Value of the PV that triggered this alarm.</li>
        <li><b>Ack</b>: Checkbox for quick acknowledge or unacknowledge
            of alarms.</li>
        <li><b>Icon</b>: Icon representing the combination of latched and
            current severities.</li>
        <li><b>Action</b>: The first alarm guidance message.</li>
        <li><b>ID</b>: The first alarm guidance title.</li>
    </ul>
    <p>The CSS Alarm Table allows sorting by any of the above
        properties by clicking the corresponded property name on the column
        header. The sorting order (ascending/descending) can be toggled by
        clicking on the header again.</p>

    <a name="#current_alarm"> </a>
    <h3>Current Alarms and Acknowledged Alarms</h3>
    <p>The Alarm Table is split into two parts for displaying current
        alarms (unacknowledged alarms) and acknowledged alarms respectively.</p>
    <ul>
        <li>For PV configured to "latch", even if its current severity
            has changed to "OK", the alarm will still be displayed as "Current
            Alarm" until it is manually acknowledged.</li>
        <li>For PV not configured to "latch", it will disappear from the
            table of "Current Alarms" once its current severity changed to "OK".</li>
        <li>For acknowledged alarm, regardless the PV is configured to
            "latch" or "not latch", if current severity of the PV is still not
            "OK", it will be displayed in the table of "Acknowledged Alarms"
            until its current severity changes to "OK".</li>
    </ul>
    <p>
        For the details about how alarm severity jumps between different
        states, please refer to the <a href="#AlarmState">Alarm Severity
            States Diagram</a>
    </p>


    <h3>Alarm Table Toolbar</h3>
    <p>
        The toolbar on top of Alarm Table provides the functions of
        "Normal/Maintenance Mode Switch" <img src="icons/operate.gif" />,
        "Acknowledge" <img src="icons/acknowledge.gif" /> and
        "Un-Acknowledge" <img src="icons/unacknowledge.gif" /> for the
        selected items in the table. The next three icons are related to
        filtering: show alarms of the configuration selected in the tree <img
            src="icons/sync.gif" />, show all alarms of the selected root <img
            src="icons/root.gif" />, show alarms that belong to selected item <img
            src="icons/item.gif" />.
    </p>
    <p>A menu (downward arrow) with commands to create a new table
        view, combine and separate tables, configure and reset columns and to
        select a filter is also provided.</p>
    <p>The tables for acknowledged and un-acknowledged alarms can
        either be separate or they can be combined into a single table. Use
        can choose the presentation from the toolbar menu.</p>
    <p>The contents of both tables can be refined by configuring the
        columns. The toolbar menu provides "Configure Columns" command. The
        command open the Column Configuration Dialog, through which it can be
        selected, which columns are visible in the table and in what order. It
        is also possible to define the time format used for the Alarm Time
        column in the table.</p>
    <img class="float" src="column_configurator.png"
        alt="Column Configuration Dialog" width="531" height="400"></img>

    <h3>Filtering</h3>
    <p>
        By default alarm table will show all alarms that belong to the
        configuration root selected in the alarm tree. This is shown in the
        table with the toolbar button <img src="icons/sync.gif" /> being
        pushed and the title of the table displayes the name of the
        configuration.
    </p>
    <p>
        If you wish to filter the alarms and show only a subset drag a node
        from the tree and drop it into the table. The table will display only
        those alarms which are equal or are descendants of the dropped item.
        This is shown by the toolbar button <img src="icons/item.gif" />
        being pushed in, the alarm table title displays the name of the item
        and at the top of the table the full path of the selected node is
        displayed.
    </p>
    <p>
        After a node is dropped on the table that table will stay locked on
        that particular node. Even if another configuration is selected in the
        alarm tree, the table will still display the alarms that belong to the
        selected node. By pressing the toolbar buttons <img
            src="icons/root.gif" /> or <img src="icons/sync.gif" /> all alarms
        belonging to the root of the selected node or to the root selected in
        the alarm tree can be displayed.
    </p>
    <p>In addition to drag and drop, selecting a filter node is also
        possible by clicking the "Select Filter..." item in the toolbar menu.
        A dialog will popup, where a full path of the item can be entered. If
        an invalid path is selected, it will be shown in the alarm table
        title.</p>

    <h3>New Alarm Table</h3>
    <p>Additional alarm tables can be open by selecting the "New Table
        View" from the toolbar drop down menu. Each table can be configured
        separately to show different alarms or different columns (see previous
        sections). The number of tables is not limited. When CSS is closed the
        settings are stored and are restored the next time CSS is started.</p>

    <h3>Select PVs based on name or description</h3>
    <p>You can enter a PV name or part of an alarm description to
        select all matching PVs in the alarm table.</p>
    <p>The filter expression can contain these wild-cards:</p>
    <ul>
        <li>'?' matches any single character</li>
        <li>'*' matches zero or more arbitrary characters</li>
    </ul>
    <p>The filter expression is not case-sensitive.</p>
    <p>Example Filter Expressions:</p>
    <ul>
        <li>'vac': Selects PVs where name or description contain 'vac',
            'vacuum', ...</li>
        <li>'amp*trip': Would for example select PVs whose description
            contains 'Amplifier Trip'</li>
    </ul>

    <h3>Context Menu Options</h3>
    <p>Most of the context menu options are also applicable for
        multiple items. In this case, the "Guidance messages", "Related
        display" and "Command" for the selected items will be merged. You can
        select multiple items by holding Ctrl or Shift key.</p>
    <ul>
        <li><img src="icons/clock.png" /> Time since event:<br>The
            elapsed time since the alarm happened.</li>
        <li><img src="icons/info.gif"/> Guidance messages:<br>
            If there are guidance messages configured for the selected items, it
            will be displayed here one by one.</li>
        <li><img src="icons/related_display.gif" /> Related displays:<br>If
            there are related displays configured for the selected items, it will
            be displayed here one by one. When you click one of them, the related
            display will be launched.</li>
        <li><img src="icons/command.gif" /> Commands:<br> If there
            are related commands configured for the selected items, it will be
            displayed here one by one. When you click one of them, the related
            command will be executed.</li>
        <li><img src="icons/elog.gif" /> LogBook...: <br>Open a
            logbook entry dialog editor for you to create an electronic logbook
            entry for the selected items in logbook.</li>
        <li><img src="icons/acknowledge.gif" />/<img
            src="icons/unacknowledge.gif" /> Acknowledge/Un-Acknowledge:<br>
            For items in the table of "Current Alarms", this should be
            "Acknowledge", so you can acknowledge the selected alarms. For itmes
            in "Acknowledged Alarms" table, this should be "Un-Acknowledge".</li>
        <li><img src="icons/configure.gif" /> Configure Item:<br>
            You can configure properties of the selected PVs: <a
            href="#pv_config">Alarm PV Configuration</a>.</li>
        <li><img src="icons/editcopy.png" /> Copy Pv Name to Clipboard</li>
        <li><code>CSS</code>: From this menu, you can access general CSS
            functions for the selected PVs.</li>
    </ul>


    <h3>'Drag' Support</h3>
    <p>Selected alarms can be 'dragged' out of the alarm table into
        another program that accepts string drops. For example, one can drag
        alarms into most email tools or the web interface to an elog system.
        The dragged text will include the alarm PV, description, and its
        current state.</p>


    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <h2>
        <a name="panel">Alarm Area Panel</a>
    </h2>
    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <p>
        The Alarm Area Panel is a top-level display of the current alarm
        state. A preference setting of the panel is used to configure which
        level of the alarm tree hierarchy it should display. <img
            class="float" src="AlarmPanel.png" alt="Alarm Panel" width="317"
            height="560"></img></p>
    <p>It will typically be used to display the first level of the
        alarm hierarchy, that is all Area components of the alarm tree. For
        each area, it displays the name, coloring the panel to indicate the
        alarm state of that area.</p>
    <p>The tool can also be used to display a single panel with the
        alarm state of the overall alarm tree, i.e. the root element, by
        configuring it to use level 0 of the alarm tree hierarchy. When set to
        level 2 of the alarm tree, it will display all System components. With
        level 3 it would display all Sub-System components, but this and
        higher alarm tree components are not useful in practice.</p>

    <p>The context menu of a panel item allows access to the alarm
        tree, opening the alarm tree view and focusing on the respecive alarm
        tree element. The context menu also allows acknowledge/un-acknowledge
        of the alarm tree item and all the alarm tree elements below it.</p>

    <p>The tool has the following preference settings:</p>
    <ul>
        <li>Alarm Tree Level: Determines from which level of the alarm
            tree the items are displayed. 0 for root, 1 for area, 2 for system, 3
            and higher would be sub-systems but that is less practical.</li>
        <li>Panel Columns: Determines in how many columns the items will
            be arranged for display.</li>
    </ul>



    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <h2>
        <a name="preferences">Preference Settings</a>
    </h2>
    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <img class="float" src="AlarmPreferences.png"
        alt="Alarm Preferences Configuration" />
    <p>
        The Alarm System has numerous preferences which can be set for the GUI
        client via the menu
        <code>CSS/Preferences...</code>
        , then navigating to
        <code>CSS Applications/Alarm/Alarm System</code>
        :
    </p>
    <p>
        For proper operation of the alarm system these settings must match
        corresponding settings of the alarm server. They should probably <u>not</u>
        be configured by end users via the preference panel but instead set by
        the system administrator via appropriate "Default Settings", see
        below.
    </p>

    <h3>Preferences</h3>
    <ul>
        <li>Configuration Name<br> The overall configuration name is
            used to select the alarm tree root component.</li>
        <li>JMS Alarm Server, Client, Talk Topics<br> These are used
            to communicate with the alarm server and have to match the alarm
            server configuration.</li>
        <li>RDB Server<br> RDB that holds alarm PVs configuration
            and snapshot of state.</li>
        <li>JMS Server<br> JMS Server for alarm messages service,
            such as new alarms, acknowledge, ...</li>
        <li>JMS Idle Timeout<br> Timeout in seconds at which server
            sends idle messages in absence of "real" traffic on alarm topic</li>
        <li>Command Directory<br> Directory used for executing
            commands. May use Java system properties like this: $(prop_name)</li>
        <li>Colors for alarm severities<br> Configures the colors
            used in the alarm table and tree to represent alarms.</li>
    </ul>

    <h3>Default Settings</h3>
    While each user may specify custom settings, administrators should
    provide default settings suitable for the respective site. These
    original settings reside in the "preferences.ini" file inside the
    org.csstudio.alarm plugin directory. These settings are usually adapted
    to a specific site in a "plugin_customization.ini" file which is
    located in the root of the "Product" plugin directory or jar file.
    Further customization is possible when starting CSS (or any Eclipse
    product) via a customization file with the same format provided via the
    <code>-pluginCustomization</code>
    command line option. Finally, each end user can use the CSS/Preferences
    menu item to interactively adjust most settings. Those changes are
    stored in the workspace directory under
    {Workspace}/.metadata/.plugins/org.eclipse.core.runtime/.settings

    <div class="clear" />

    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <h2>
        <a name="edit">Editing the Alarm Configuration</a>
    </h2>
    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <p>
        To edit the overall alarm configuration, that is to add components to
        the hierarchical alarm tree, including Alarm Trigger PVs, or to
        rearrange the alarm tree layout, use the context menu of the <a
            href="#tree">Alarm Tree</a>.
    </p>

    <img class="float" src="pv_config2.png" width="639" height="722" />

    <p>The context menu entry "Configure item" opens a dialog box
        similar to the one shown on the right. The following explains
        configuration elements common to all alarm tree items. The next
        section will elaborate on specifics of Alarm Trigger PVs.</p>

    <h3>Item</h3>
    <p>The item name displayed at the top of the dialog is the
        hierarchical path to item. The item name is set when adding the item
        to the alarm configuration. It cannot be modified within this dialog,
        but there are are options in the context menu of the alarm tree to
        rename an item or to move it to another location in the alarm tree.</p>


    <h3>Guidance</h3>
    <p>A list of guidance messages for this item. Note that items also
        "inherit" all guidance messages of the higher-level components
        (System, Subsystem, ...) under which they are listed, i.e. their
        "parent" components from the alarm configuration hierarchy.</p>
    <p>Each guidance is separated into two parts:</p>
    <ul>
        <li>Title: The title to be displayed as a context menu item and
            in the title of the guidance information dialog. The max length of
            title is 30 characters.</li>
        <li>Details: Details of the guidance to be displayed in the
            guidance information dialog. May span multiple lines.</li>
    </ul>
    <p>
        <b>Tip:</b> If the guidance is very short and fits into the title, it
        is sufficient to only enter the title. Whenever you only configure the
        title and leave the details empty, or only configure the details and
        leave the title empty, this implies that the respective other part is
        the same as the part you configured.
    </p>


    <h3>Related Displays</h3>
    <p>A list of related displays. Supported formats:</p>
    <ol>
        <li>Operator Interface Display Files<br> If your CSS setup
            contains support for an operator interface panel tool, its screens
            can be opened by simply providing the screen file name within the
            workspace. <br> <code>/CSS/Share/DisplayFiles/Section/TheFile.opi</code><br>
            If the path name contains spaces, it has to be enclosed in quotes:<br>
            <code>"/CSS/Share/My Display Files/TheFile.opi"</code><br> <br>
            Additional parameters can be provided after the file name. For BOY
            *.opi screens this is a list of macros and their values, separated by
            comma, enclosed in quotes:<br> <code>/CSS/Share/DisplayFiles/Section/TheFile.opi
                "macro1=Value 1, macro2=Another Value"</code><br> <br> To use a
            web link as the display file name, it has to be prefixed by "opi:" to
            prevent it from being opened in a web browser:<br> <code>opi:http://my_display_file_server/get_display.cgi?name=TheFile.opi</code><br></li>
        <li>Web Pages<br> Related displays starting in "http:" or
            "https:" are recognized as web page links. A web browser will be
            launched when the user selects this related display:<br> <code>http://some.web.server/page/foo.html</code></li>
        <li>Workspace Files<br> Arbitrary workspace files, for
            example a Data Browser configuration file, can be opened via a URL
            starting in "file:":<br> <code>file:/Path/to/the_file.extension</code></li>
        <li>External Programs<br> To start external display tools
            like EDM or MEDM, enter a command-line like<br> <code>startedm
                -m macro=value some_screen</code><br> Related displays are executed as
            described under "Commands", see below, so this requires a script like
            "startedm" to be available on your computer that can launch EDM with
            the appropriate settings. Note that the command to be executed must
            be on the path or in the "Command Directory". It is not possible to
            provide a full path to the external display command because a path
            starting with "/" would be treated as a display file name, not an
            external command. <br> The main reason for listing EDM etc. as
            related displays and not commands is the different way they appear to
            the end user.
        </li>
    </ol>
    <p>As with guidance, each display item is separated into "Title"
        and the "Command" which in this case is the actual related display
        link.</p>


    <h3>Commands</h3>
    <p>A list of commands that the user might want to invoke. Enter a
        suitable command-line for executing the command, for example</p>
    <p>
        <code>/usr/local/bin/do_something MyPVName "another parameter"</code>
    </p>
    <p>The command itself must either be on the operating system path
        ($PATH in Unix) as it was set when CSS was started, or the command
        name is listed with its full path as shown in the example above.</p>
    <p>Quotes (") can be used to include spaces inside an argument.</p>
    <p>The command will be executed with the "current directory" set to
        the "Command Directory" that is configured in the alarm system
        preferences</p>
    <pre>org.csstudio.alarm.beast/command_directory</pre>
    . Note that the commands are executed by the operating system that runs
    the notfier. Commands in the
    <pre>command_directory</pre>
    may not be executed unless the PATH variable of the operating system
    includes the current directory ".", the command itself is specified as
    "./the_command" to select the current directory as set via the
    <pre>command_directory</pre>
    , or the PATH lists the full path to the
    <pre>command_directory</pre>
    .


    <p>
        A suggested setup would probably place all alarm system related
        commands in a directory like
        <code>/usr/local/css/alarm_scripts</code>
        , include that in the operating system path and also set the "Command
        Directory" to it.
    </p>
    <p>If the command fails to execute, this will be displayed in a
        dialog box. Otherwise the program is allowed to run unattended, i.e.
        the alarm GUI does not wait for the command to finish.</p>

    <p>As with guidance and related displays, each command item is
        separated into "Title" and the "Command" which in this case is the
        actual command to invoke.</p>


    <h3>Automated Actions</h3>

    <p>These settings allow the alarm server or a separate tool
       like the "alarm-notifier" to react to alarms.</p>

    <h4>Severity PVs</h4>

    <p>The alarm server can update PVs with the current alarm severity
       of an area, system or subsystem in the alarm hierarchy.
       It is most efficiently used on the "area",
       so one PV can indicate the alarm summary of a whole area.
    </p>

    <p>This can be useful for compatibility with ALH, or to trigger
       further IOC logic based on alarms.
    </p>

    <p>The "Detail' of the automated action needs to be set to
       <code>sevrpv:NameOfPV</code>.
       The "Title" and "Delay" of the automated action are ignored.
    </p>

    <p>Whenever the alarm severity of the area or (sub-) system changes,
       the ordinal of the alarm severity will be written to the PV,
       i.e. a number 0 to 8 representing
       OK, MINOR_ACK, MAJOR_ACK, INVALID_ACK, UNDEFINED_ACK,
       MINOR, MAJOR, INVALID, UNDEFINED.
       A suitable PV would be a numeric EPICS record, or this enumerated record:
    </p>
    <pre>
# Example for "Severity PV"
# used with automated action set to "sevrpv:NameOfPV"
#
# softIoc -s -m N=NameOfPV -d sevrpv.db

record(mbbi, "$(N)")
{
    field(ZRVL, 0)
    field(ZRST, "OK")
    field(ONVL, 1)
    field(ONST, "MINOR_ACK")
    field(ONSV, "MINOR")
    field(TWVL, 2)
    field(TWST, "MAJOR_ACK")
    field(TWSV, "MAJOR")
    field(THVL, 3)
    field(THST, "INVALID_ACK")
    field(THSV, "INVALID")
    field(FRVL, 4)
    field(FRST, "UNDEFINED_ACK")
    field(FRSV, "INVALID")
    field(FVVL, 5)
    field(FVST, "MINOR")
    field(FVSV, "MINOR")
    field(SXVL, 6)
    field(SXST, "MAJOR")
    field(SXSV, "MAJOR")
    field(SVVL, 7)
    field(SVST, "INVALID")
    field(SVSV, "INVALID")
    field(EIVL, 8)
    field(EIST, "UNDEFINED")
    field(EISV, "INVALID")
    field(INP,  "0")
    field(PINI, "YES")
}
    </pre>
    <p>In your IOC you can now for example add logic that
       reacts when the "sevrpv:.." stays at 5 or higher for some time,
       i.e. when there is an alarm that has not been acknowledged for some time.
    </p>

    <p>When using "sevrpv:.." to send the alarm severity of nodes in the
       alarm hierarchy to PVs, note that these PVs will not be updated
       in case the alarm server is stopped, either on purpose or because
       of a malfunction.
       The <code>org.csstudio.alarm.beast/heartbeat_pv</code> preference of
       the alarm server can be set to the name of a PV which will be set to 1
       every 10 seconds
       (period can be changed via
       The <code>org.csstudio.alarm.beast/heartbeat_secs</code>).
       A record like this can be used to verify a continuous heartbeat:
    </p>
    <pre>
# Example for "Heartbeat PV"
#
# Alarm Server sets it to 1 every ~10 seconds,
# see heartbeat_pv and heartbeat_secs preferences.
#
# softIoc -s -m S=Demo -d heartbeat.db

record(bo, "$(S):AlarmServerHeartbeat")
{
    # If Alarm Server doesn't write '1' every 10 seconds,
    # drop to 0 after 30 secs.
    field(HIGH, "30")
    field(ZNAM, "Timeout")
    field(ZSV,  "MAJOR")
    field(ONAM, "OK")
    field(DOL,  "1")
    field(PINI, "YES")
}
    </pre>


    <h4>Notifications</h4>

    <p>The automated notifications are performed by a designated
       "alarm-notifier" that must be running in parallel to the alarm server.
    </p>

    <p>If alarms persist for a certain time without being acknowledged
        or cleared, and automated notification can be generated.</p>
    <p>If you configure a notification for an alarm trigger PV, the
        default message will contain the alarm info for that PV. If you
        configure a notification for a system or area, the default message
        will list the PVs in alarm below that section of the alarm tree.</p>
    <p>The configuration of an automated notification has three parts:</p>

    <ol>
        <li>Title: The title to be displayed as a context menu item. The
            max length of title is 30 characters.</li>
        <li>Delay: Delay in seconds before the notification is performed.
            If the alarm is acknowledged or clears before this delay, no
            notification will be performed.</li>
        <li>Details: Details of the automated action to be executed. The
            exact format of the notification detail depends on the type of
            notification, for example email, as listed below.</li>
    </ol>



    <h4>Email Notifications</h4>
    <p>Email notifications start with "mailto:", using the RFC 6068 URL
        schema.</p>
    <p>Examples:</p>
    <pre>
mailto:user@my.org
mailto:list1@example.com,list2@example.fr
mailto:list1@example.com;list2@example.fr;list3@example.fr
mailto:user1@my.org?cc&#61;support@my.org&amp;bcc&#61;john.doe@gmail.com
mailto:user@my.org?cc&#61;rf@my.org&amp;subject&#61;*RF Source 1 in error&amp;body&#61;{0} Alarm raised - Water below {1} m3
</pre>

    <p>
        Within the configuration, the text
        <code>{0}</code>
        will be replaced with the alarm severity and
        <code>{1}</code>
        with the value that triggered the alarm.
    </p>

    <h4>SMS Notifications</h4>
    <p>
        SMS notifications start with "sms:", using the RFC 3966 URL schema. It
        will send an email at the following adresse: [sms:<i>phone_number</i>(,<i>phone_number</i>)*].
        This formatting need to be handled by the email gateway.
    </p>
    <p>Examples:</p>
    <pre>
sms: +33 4 42 17 64 21, +33 6 03 74 36 61; +33 4 42 17 61 08
sms: +33 6 03 74 36 61?body={0} Alarm raised - Water below {1} m3
</pre>

    <p>
        Within the configuration, the text
        <code>{0}</code>
        will be replaced with the alarm severity and
        <code>{1}</code>
        with the value that triggered the alarm.
    </p>

    <h4>Electronic Logbook Notifications</h4>
    <p>Electronic Logbook notifications start with "log:" and require
        the specification of at least one logbook. It will create a new entry
        with alarm information such as:</p>
    <pre>
/demo/TEST-BST0/TEST-BST0:
MAJOR alarm: Whenever the LOW switch becomes dry, the pump will be forced OFF
PV                      : TEST-BST0:LOW-SWITCH
Alarm Time              : 2014/04/09 13:35:610 (Time since event: 0:01:01)
Alarm Severity/Message  : MAJOR/STATE_ALARM
Alarm Value             : Dry
Current Severity/Message: MAJOR/STATE_ALARM
</pre>
    <p>Examples:</p>
    <pre>
log:Sandbox
log:Cryo, Maintenance&amp;level&#61;Problem&amp;tags&#61;session_leader
log:Cryo&amp;body&#61;{0} Alarm raised - Water below {1} m3
</pre>

    <p>
        Within the configuration, the text
        <code>{0}</code>
        will be replaced with the alarm severity and
        <code>{1}</code>
        with the value that triggered the alarm.
    </p>

    <h4>External Command</h4>
    <p>The prefix "cmd:" selects an external command to be executed.
        Examples:</p>
    <p>Examples:</p>
    <pre>cmd:caput SomePV 1
cmd:my_notifier *
</pre>

    <p>
        Within the configuration, the text
        <code>*</code>
        will be replaced with a list of alarm PVs and alarm severities.
    </p>

    <p>The command is executed with the working directory defined by
        the preference</p>
    <pre>org.csstudio.alarm.beast/command_directory</pre>
    of the notifier.


    <!-- Not implemented:
SMS: sms URL scheme (RFC 5724). Example: "sms:+15105550101,+15105550102"
Phone: tel URL scheme (RFC 2806). Example: "tel:+15105550101,+15105550102"s
 -->

    <h4>Sequence of commands</h4>
    <p>Several commands can be executed one after an other in the same
        automated notification using quotes and ';' as separators.</p>
    <p>Example:</p>
    <pre>
"mailto:list1@example.com,list2@example.fr";"cmd:caput SomePV 1"
</pre>


    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <h2>
        <a name="pv_config">Alarm Trigger PV Configuration</a>
    </h2>
    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <p>For alarm trigger PVs, the configuration explained in the
        previous section contains additional elements that are specific to
        PVs.</p>

    <h3>Item</h3>
    <p>The last section of the item name displayed at the top of the
        dialog must be a PV name understood by the control system. The PV name
        is set when adding the PV to the alarm configuration. The PV name
        cannot be modified within this dialog, but there are are options in
        the context menu of the alarm tree to rename the PV or to move it to
        another location in the alarm tree.</p>

    <h3>Description</h3>
    <p>The PV's description should be more human-readable than the raw
        PV name. It is displayed with the alarm and also used for
        annunciation.</p>
    <p>
        Check the <a href="#annunciation">annunciation</a> description further
        below for details on how the description is used for the annunciation
        of alarms.
    </p>

    <h3>Enabling Alarms</h3>
    <p>Per default all alarms are enabled. By de-selecting the
        "enabled" check-box the alarm server can be configured to ignore
        alarms from this PV.</p>
    <p>
        <em> This is meant as a temporary fix, for example to handle a
            broken sensor that causes erroneous alarms. Disabled alarms should be
            reviewed periodically and then either removed from the alarm
            configuration or fixed so that they can be re-enabled. </em>
    </p>


    <h3>Latching Alarm Behavior</h3>
    <p>The latching behavior defines how the alarm server handles a PV
        that goes into an alarm state, and then recovers. When configured to
        "latch", the alarm server remembers the highest alarm severity of the
        PV until it is manually acknowledged.</p>


    <h3>Alarm Annunciation</h3>
    <p>
        When a PV is configured to "annunciate", the alarm server will send
        the PV's description to the <a href="#annunciation">annunciation
            system</a> whenever the PV reaches a non-OK severity.
    </p>


    <h3>Alarm Delay and Count Filter</h3>
    <p>Per default, the alarm server will react as soon as it notices a
        non-OK alarm severity. When adding a delay greater than zero,
        specified in seconds, it will only react when the alarm severity
        remains for at least this time. When an additional alarm count greater
        than zero is specified, it will react to alarms that either outlast
        the delay, or happen at least "count" times within the delay.</p>
    <p>Both these options can reduce the amount of "nuisance" alarms
        from noisy PVs, but in practice it is always best to cure the problem
        at the source through adequate dead-bands or smoothing.</p>


    <h3>Filter</h3>
    <p>A filter expression can be used to enable or disable alarms
        automatically. When entering a filter expression, the previously
        described "enable" field is ignored.</p>
    <p>The filter expression can be something like</p>
    <p>
        <code>some_other_pv > 5</code>
    </p>
    <p>to only enable the alarm when the other PV has a value above 5.
    </p>
    <p>
        This feature was added to ease the transition from other alarm
        handling systems. Ideally, state-based alarms are <em>handled on
            the front-end computer by adding logic that prevents the alarm from
            being generated,</em> instead of generating an alarm but then disabling it
        in the alarm server.
    </p>
    <p>
        Also note a shortcoming of the current implementation: The Alarm
        Server only subscribes to PV value updates for alarm changes, and this
        includes the PVs used to compute the filter expression. An alarm
        expression like
        <code>some_other_pv &gt; 5</code>
        will <u>not</u> be evaluated for each change in the value of
        <code>some_other_pv</code>
        ; it <em>will only be evaluated for changes in the alarm state</em> of
        <code>some_other_pv</code>
        , so the value changes used in the filter expression must also be
        alarm state changes of
        <code>some_other_pv</code>
        !
    </p>



    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <h2>
        <a name="annunciation">Voice Annunciation</a>
    </h2>
    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <p>
        For alarms that are <a href="#pv_config">configured to be
            annunciated</a>, the alarm server sends an annunciation request to the
        annunciator.
    </p>
    <p>The annunciation is performed by is either the Annunciator view
        included in the CSS alarm user interface, or the standalone
        Annunciator tool. In the control room, at least one instance of these
        annunciation tools should be running on a designated alarm OPI at all
        times.</p>

    <h3>Annunciator</h3>
    <p>
        The CSS Annunciator included in CSS is started via the menu
        <code>CSS/Alarm/Annunciator</code>
        and has to remain visible to function.
    </p>

    <h3>Annunciator</h3>
    <p>The Annunciator is also available as standalone tool. While it
        has to be launched from the command-line, separate from the CSS GUI,
        its advantage lies in the fact that it continues to annunciate even
        when the CSS GUI is closed. It will annunciate independently from
        alarm table or -tree displays.</p>
    <p>It is usually launched by a shell command</p>
    <pre>
  annunciator
</pre>

    <h3>Annunciation Text</h3>
    <p>By default, the alarm server will use the "Description" of an
        alarm for annunciation, prefixed by the alarm severity.</p>
    <p>For example, a MAJOR alarm on a PV with Description "Low Water
        Pressure" will result in an annunciation</p>
    <pre>
  "MAJOR alarm: Low Water Pressure"
</pre>

    <p>
        When prefixed with an asterisk character '*', the alarm server will
        use the description as given. It will <i>not</i> prefix it with the
        alarm severity.
    </p>
    <p>A PV with Description "*Low Water Pressure" thus results in just
        announcing</p>
    <pre>
  "Low Water Pressure"
</pre>


    <p>In addition, descriptions starting with '*' can include the
        following formatting elements:</p>
    <ul>
        <li>The text "{0}" is replaced with the current alarm severity.</li>
        <li>The text "{1}" is replaced with the value of the trigger PV
            that caused the alarm.</li>
    </ul>

    <p>For example, a PV with description "*{0} alarm: Low Water
        Pressure" would again result in an annunciation</p>
    <pre>
  "MAJOR alarm: Low Water Pressure"
</pre>
    The effect would be the same as having used the default annunciation
    format without "*...".
    <p>By using the "*..." format, however, you can also use
        descriptions like "*{0} water alarm, level is {1} gallons" which will
        result in an annunciation similar to</p>
    <pre>
  "MAJOR water alarm, level is 3.142 gallons"
</pre>
    <p>The format elements can be in any order. For example, the value
        can be used before the alarm severity. The description "*Water below
        {1} gallons, {0} alarm" will result in an annunciation similar to</p>
    <pre>
  "Water below 3.142 gallons, MAJOR alarm"
</pre>


    <h3>Annunciation Order</h3>
    <p>Fundamentally, messages are annunciated in the order of arrival.
        When several messages arrive at almost the same time, or more messages
        arrive while the first message is annunciated, those are ordered by
        severity, most severe first.</p>

    <h3>Annunciation Throttle</h3>
    <p>When many alarms occur at the same time, this could result in a
        long stream of voice annunciation. Operators, on the other hand,
        probably don't need to hear every single alarm annunciated as much as
        they need to be alerted to the fact that many alarms happened, so they
        can use their judgment to determine which one is most important.</p>
    <p>The annunciator therefore has a message count threshold (default
        3): Assuming that 10 more messages arrive after annunciating the first
        message, exceeding the threshold of 3, the tool will annunciate</p>
    <pre>
  "There are ten more messages"
</pre>
    instead of annunciating each individual message.

    <h3>Priority Annunciations, Circumventing the Annunciation
        Throttle</h3>
    <a name='priority'> </a>
    <p>For alarms deemed too important to be suppressed by the
        annunciation throttle, the Description can be prefixed with a "!":</p>
    <pre>
  !The sky is falling
</pre>

    <p>In case the alarm severity should not be included in the
        annunciation, but the annunciation should always happen and not be
        filtered by the annunciation throttle, use this format:</p>
    <pre>
  *!The sky is falling
</pre>
    <p>Either '*!' as shown with '*' first, then '!', or '!*' are
        allowed. The '*' tells the alarm server to suppress the alarm severity
        because a custom format is used, the '!' instructs the annunciator to
        exclude this message from the message throttle.</p>


    <h3>Annunciator Settings</h3>
    <p>The Annunciator has its own preference settings. In principle,
        this would allow use of one annunciator for multiple alarm systems.</p>
    <ul>
        <li>URL: JMS server URL. Usually has to match the URL used by the
            Alarm Server and client GUI, but allows use of the Annunciator in
            other setups, for example by pointing to the URL of a JMS mirror for
            multiple alarm server setups.</li>
        <li>Topics: Comma-separated list of JMS TOPICS. Typically those
            used by Alarm Servers.</li>
        <li>Translation File: The computer speech library is imperfect.
            Especially abbreviations are better spelled out ("Mebbit" instead of
            "MEBT"). A translations file can include such translations which are
            automatically applied to all received TEXT before it is annunciated.<br>
            Specify the full path to a file that contains this: <pre>
# File of translations
# Format:
#       some_regular_expression_pattern = translation

INVALID=in valid
MEBT=mebbit
    </pre> To avoid confusion, though, it's usually better to <u>not</u> use
            translations and instead change the annunication text in the Alarm
            Server configuration.
        </li>
        <li>Severities: Comma-separated list of recognized severities,
            highest priority first.</li>
        <li>Threshold: Number of queued messages beyond which messages
            are cleared.</li>
        <li>Message History: Number of past messages shown in the
            annunciator history.</li>
    </ul>

</body>
</html>

